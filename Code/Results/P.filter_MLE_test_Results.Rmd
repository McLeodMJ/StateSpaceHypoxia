---
title: "Pfilter.Results"
author: "Montana McLeod"
date: "1/11/2022"
output: html_document
---

```{r setup, include=FALSE}
require("knitr")
opts_knit$set(root.dir = "~/Documents/THESIS/StateSpaceHypoxia/Code/Library")
```


# load/ libraries and data
```{r}
library(ggplot2)
library(viridis)
library(tidyverse)
source("params.R")
Sp_selex <- read.csv("~/Documents/THESIS/StateSpaceHypoxia/Data/Sp.selex.csv") # 
load("~/Documents/THESIS/StateSpaceHypoxia/Code/Results/Expected_Fishing_rate.Rdata") #from the SPR vs fishing values ## F priors
load("../Data/test_param_sigma_values.Rdata") # the df(s) we used to simulate diff. values of sigma or params
source("~/Documents/THESIS/StateSpaceHypoxia/Code/Library/params.R")

# find the average for sigma tests
Avgs_sigma_list <- list(sigma_0.001 = MLE_test_sigma_output0.001_part1,
        sigma_0.01 = MLE_test_sigma_output0.01_part1,
        sigma_0.1 = MLE_test_sigma_output0.1_part1,
        sigma_0.5 = MLE_test_sigma_output0.5_part1,
        sigma_2 = MLE_test_sigma_output_2_part1)

Avgs_sigma_lists <- list(sigma_0.001 = MLE_test_sigma_output0.001_part2,
        sigma_0.01 = MLE_test_sigma_output0.01_part2,
        sigma_0.1 = MLE_test_sigma_output0.1_part2,
        sigma_0.5 = MLE_test_sigma_output0.5_part2,
        sigma_2 = MLE_test_sigma_output_2_part2)


# find the average for param variation tests
Avgs_param_list <- list(fi_0.008.hypox_0.4 = test_param_output.1,
        fi_0.001 = test_param_output.2,
        fi_0.2 = test_param_output.3,
        hypox_0.1 = test_param_output.4,
        hypox_4 = test_param_output.5,
        hypox_8 = test_param_output.6)


Avgs_param_lists <- list(fi_0.008.hypox_0.4 = test_param_output1,
        fi_0.001 = test_param_output2,
        fi_0.2 = test_param_output3,
        hypox_0.1 = test_param_output4,
        hypox_4 = test_param_output5,
        hypox_8 = test_param_output6)


Avgs_param_list3 <- list(MLE_std = MLE_std,
        fi_0.001 = MLE_fi_0.001,
        fi_0.2 = MLE_fi_0.2,
        hypox.b_1 = MLE_hy.b_1,
        hypox_.b10 = MLE_hy.b_10,
        hypox.a_0.1 = MLE_hy.a_0.1,
        hypox.a_6 = MLE_hy.a_6)

Avgs_param_list3.2 <- list(MLE_std = MLE_std.2,
        fi_0.001 = MLE_fi_0.001.2,
        fi_0.2 = MLE_fi_0.2.2,
        hypox.b_1 = MLE_hy.b_1.2,
        hypox_.b10 = MLE_hy.b_10.2,
        hypox.a_0.1 = MLE_hy.a_0.1.2,
        hypox.a_6 = MLE_hy.a_6.2)
```


## OPTION 1
# if adjusting the fi & hypox_p param each iteration
```{r}
 test_params <- cbind( c(rep(0.4, 3), 0.1, 4, 8),  # hypox_p
                      c(log(pars$f), log(0.001), log(0.2), rep(log(pars$f), 3))) #fi
 
# placeholders to save the coefs and averages across replicates
avgs <- matrix(NA, nrow = (length(Avgs_param_list)+6), ncol = 24)
tots <- NULL

# extract coeficeints from each iteration and find the mean of each test
for(l in 1:length(Avgs_param_list)){
  tots <- NULL
  for (z in 1:5){
  zz <- coef(Avgs_param_list[[l]][[z]])
  tots <-rbind(tots, zz)
  }
  avgs[(l),] <- colMeans(tots)
}

# find averages between both runs 
for(l in 1:length(Avgs_param_lists)){
  tots <- NULL
  for (z in 1:5){
    zz <- coef(Avgs_param_lists[[l]][[z]])
    tots <-rbind(tots, zz)
  }
  avgs[(l+6),] <- colMeans(tots) 
}
avgs = avgs[, c(1:2,4:24)]


# since I broke up the for loop to be quicker need to take average of those two averaged values
Avgs <- matrix(NA, nrow = length(Avgs_param_list), ncol = 23)
for (l in 1:6){
  Avgs[l,] <- colMeans(avgs[c(l, (l+6)), ]) 
}
summ <- data.frame( Estimate = c(Avgs[1,], Avgs[2,], Avgs[3,], Avgs[4,], Avgs[5,], Avgs[6,])) 
summ$Param <- rep(c("hypox_p", "fi", "sigma_p", "rec1", "rec2", "rec3", "rec4", "rec5", "rec6", "rec7", "rec8", "rec9","rec10", "rec11","rec12", "rec13", "rec14", "rec15", "rec16", "rec17", "rec18", "rec19", "rec20"), 6) 


###################

# modify df to have true values & param combos
values <- NULL
test_chr <- NULL
for(tt in 1:6){
  val <- c(test_params[tt,1], exp(test_params[tt,2]), 0.5, rep(0.1, 20))
  values <- c(values, val)
  chr <- paste("(",test_params[tt,1],")",  "(",exp(test_params[tt,2]),")", sep="")
  test_chr <- c(test_chr, chr)
}
summ$Estimate <- ifelse(summ$Param != "hypox_p", exp(summ$Estimate), summ$Estimate)

summ$Bias <- ((summ$Estimate - values) / summ$Estimate) *100
summ$Test <- rep(test_chr, each = 23)

true <- data.frame(Estimate = c(test_params[1,1],exp(test_params[1,2]), 0.5, rep(0.1, 20)),
                   Param = c("hypox_p", "fi", "sigma_p", "rec1", "rec2", "rec3", "rec4", "rec5", "rec6", "rec7", "rec8", "rec9","rec10", "rec11","rec12", "rec13", "rec14", "rec15", "rec16", "rec17", "rec18", "rec19", "rec20"))

```

## OPTION 2
# if adjusting the level of sigma each iteration 
```{r}
 test_params <- cbind( c(rep(0.4, 3), 0.1, 4, 8),  # hypox_p
                      c(log(pars$f), log(0.001), log(0.2), rep(log(pars$f), 3))) #fi
 
# placeholders to save the coefs and averages across replicates
avgs <- matrix(NA, nrow = (length(Avgs_sigma_list)+5), ncol = 24)
tots <- NULL

# extract coeficeints from each iteration and find the mean of each test
for(l in 1:length(Avgs_sigma_list)){
  tots <- NULL
  for (z in 1:5){
  zz <- coef(Avgs_sigma_list[[l]][[z]])
  tots <-rbind(tots, zz)
  }
  avgs[(l),] <- colMeans(tots)
}

# find averages between both runs 
for(l in 1:length(Avgs_sigma_lists)){
  tots <- NULL
  for (z in 1:7){
    zz <- coef(Avgs_sigma_lists[[l]][[z]])
    tots <-rbind(tots, zz)
  }
  avgs[(l+5),] <- colMeans(tots) 
}
avgs = avgs[, c(1:2, 4:24)]


# since I broke up the for loop to be quicker
Avgs <- matrix(NA, nrow = length(Avgs_sigma_list), ncol = 23)
for (l in 1:6){
  Avgs[l,] <- colMeans(avgs[c(l, (l+5)), ])
}
summ <- data.frame( Estimate = c(Avgs[1,], Avgs[2,], Avgs[3,], Avgs[4,], Avgs[5,])) 
summ$Param <- rep(c("hypox_p", "fi", "sigma_p", "rec1", "rec2", "rec3", "rec4", "rec5", "rec6", "rec7", "rec8", "rec9","rec10", "rec11","rec12", "rec13", "rec14", "rec15", "rec16", "rec17", "rec18", "rec19", "rec20"), 5) 


################################################

# modify df to have true values & param combos
values <- NULL
test_chr <- NULL
for(tt in 1:5){
  val <- c(params_log[1,1], exp(params_log[1,2]), exp(params_log[tt,3]), rep(0.1, 20))
  values <- c(values, val)
  chr <- paste("(",exp(params_log[tt,3]),")", sep="")
  test_chr <- c(test_chr, chr)
}
 summ$Estimate <- ifelse(summ$Param != "hypox_p", exp(summ$Estimate), summ$Estimate)

summ$Bias <- ((summ$Estimate - values) / summ$Estimate) *100
summ$Test <- rep(test_chr, each = 23)

true <- data.frame(Estimate = c(test_params[1,1],exp(test_params[1,2]), 0.5, rep(0.1, 20)),
                   Param = c("hypox_p", "fi", "sigma_p", "rec1", "rec2", "rec3", "rec4", "rec5", "rec6", "rec7", "rec8", "rec9","rec10", "rec11","rec12", "rec13", "rec14", "rec15", "rec16", "rec17", "rec18", "rec19", "rec20"))
```

# OPTION 3
# for the new parameter estimates, hypox_a, hypox_b and fi
```{r}
test_params <- cbind( c(rep(3, 5), 0.1, 6),  # hypox_a
                       c(rep(-7, 3), -1, -10, rep(-7, 2)), #hypox_b
                      c(log(pars$f), log(0.001), log(0.2), rep(log(pars$f), 4))) #fi
 
# placeholders to save the coefs and averages across replicates
avgs <- matrix(NA, nrow = (length(Avgs_param_list3)*2), ncol = 25)

# extract coeficeints from each iteration and find the mean of each test
for(l in 1:length(Avgs_param_list3)){
  avgs[l,] <- coef(Avgs_param_list3[[l]])
  avgs[l+7,] <- coef(Avgs_param_list3.2[[l]])
  }
avgs = avgs[, c(1:3, 5:25)]


# since I broke up the for loop to be quicker
Avgs <- matrix(NA, nrow = length(Avgs_param_list3), ncol = 24)
for (l in 1:7){
  Avgs[l,] <- colMeans(avgs[c(l, (l+7)), ])
}
summ <- data.frame( Estimate = c(Avgs[1,], Avgs[2,], Avgs[3,], Avgs[4,], Avgs[5,] , Avgs[6,], Avgs[7,])) 
summ$Param <- rep(c("hypox_a","hypox_b", "fi", "sigma_p", "rec1", "rec2", "rec3", "rec4", "rec5", "rec6", "rec7", "rec8", "rec9","rec10", "rec11","rec12", "rec13", "rec14", "rec15", "rec16", "rec17", "rec18", "rec19", "rec20"), 7) 

# modify df to have true values & param combos
values <- NULL
test_chr <- NULL
for(tt in 1:7){
  val <- c(test_params[tt,1],test_params[tt,2], exp(test_params[tt,3]), 0.5, rep(0.1, 20))
  values <- c(values, val)
  chr <- paste("(",test_params[tt,1],")", "(",test_params[tt,2],")", "(",exp(test_params[tt,3]),")", sep="")
  test_chr <- c(test_chr, chr)
}
summ$Estimate <- ifelse(summ$Param != "hypox_a" & summ$Param != "hypox_b" , exp(summ$Estimate), summ$Estimate)

summ$Bias <- ((summ$Estimate - values) / summ$Estimate) *100
summ$Test <- rep(test_chr, each = 24)

true <- data.frame(Estimate = c(test_params[1,1],test_params[1,2], exp(test_params[1,3]), 0.5, rep(0.1, 20)),
                   Param = c("hypox_a","hypox_b", "fi", "sigma_p", "rec1", "rec2", "rec3", "rec4", "rec5", "rec6", "rec7", "rec8", "rec9","rec10", "rec11","rec12", "rec13", "rec14", "rec15", "rec16", "rec17", "rec18", "rec19", "rec20"))
``` 


## OPTION FOUR
# test with different larger values of Fi and without hypoxia
```{r}

# load(Dsole_MLE_det or Dsole_MLE_NOdet) # all of them =(5 each)
test_params <- data.frame(Fi= c(log(pars$f), log(0.001), log(0.05), log(0.1), log(0.2))) #fi


Fi_ests_det <- c(exp(coef(summary(Dsole_MLE_det_fi.std[[1]]))[3,1]),  exp(coef(summary(Dsole_MLE_det_fi.001[[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi.1[[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi.2[[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi.std[[2]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi.001[[2]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi.1[[2]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi.2[[2]]))[3,1]))
Fi_ests_NOdet <- c( exp(coef(summary(Dsole_MLE_NOdet_fi.std[[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.001[[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.1[[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.2[[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.std[[2]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.001[[2]]))[1,1]),  exp(coef(summary(Dsole_MLE_NOdet_fi.1[[2]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.2[[2]]))[1,1]))
real_fi = pars$f

Fi_avgs_det <- rep(NA, 4)
Fi_avgs_NOdet <-  rep(NA, 4)
for (l in 1:4){
  Fi_avgs_det[l] <- mean(Fi_ests_det[c(l, (l+4))])
  Fi_avgs_NOdet[l] <- mean(Fi_ests_NOdet[c(l, (l+4))])
}

hypox_param_check <- data.frame(true_Fi = rep(real_fi, length(Fi_ests_det)),
                                Test = rep(c("W/out_Hypoxia", "Hypoxia_inc."), each = 4),
                                Fi_Estimate = c(Fi_avgs_NOdet, Fi_avgs_det),
                                Test_value = as.character(rep( c(pars$f, 0.001, 0.1, 0.2), 2)))

hypox_param_check <- hypox_param_check %>% 
  mutate(Percent_Diff = (Test_value - Fi_Estimate)*100)
hypox_param_check$Percent_Diff <- as.character(round(hypox_param_check$Percent_Diff, 4))

True_Fi <- data.frame(x= c(-Inf, Inf),
                      y= round(hypox_param_check$true_Fi[1],5),
                      True_Fi = factor(round(hypox_param_check$true_Fi[1],5)))

mortality <- data.frame(x= c(-Inf, Inf),
                      y= pars$M,
                      mortality = factor(pars$M))

ggplot(hypox_param_check, aes(x=Test, y=Fi_Estimate))+
  geom_point(aes(color=Test_value))+
  scale_color_viridis(discrete=T)+
  #scale_color_manual(values = c("#00AFBB", "#E7B800")) +
  geom_line(aes(x, y, linetype = True_Fi), True_Fi, color="red")
  #geom_line(aes(x, y, linetype = mortality), mortality, color = "purple")

```


## OPTION Five
# test with true Fi and very large Fi with and without hypoxia
```{r}
pars <- params("Dsole")
library(patchwork)
# load(Dsole_MLE_det or Dsole_MLE_NOdet) # all of them =(5 each)
test_params <- data.frame(Fi= c(log(pars$f), log(0.2))) #fi

# MLE results for runs with hypoxia 
Fi_ests_det <- c(exp(coef(summary(Dsole_MLE_NOdet_fi.std_hyp1[[1]]))[3,1]),  exp(coef(summary(Dsole_MLE_NOdet_fi.std_hyp2[[1]]))[3,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.std_hyp3[[1]]))[3,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.std_hyp4[[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi.2_1[[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi.2_2[[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi.2_3[[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi.2_4[[1]]))[3,1]))
# MLE results for runs without hypoxia
Fi_ests_NOdet <- c(exp(coef(summary(Dsole_MLE_NOdet_fi.std1[[1]]))[1,1]),  exp(coef(summary(Dsole_MLE_NOdet_fi.std2[[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.std3[[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.std4[[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.2_1[[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.2_2[[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.2_3[[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi.2_4[[1]]))[1,1]))
real_fi = pars$f


## number of absences per sample 
Pop_det <- rbind( colSums(Dsole_MLE_NOdet_fi.std_hyp1[[2]]), colSums(Dsole_MLE_NOdet_fi.std_hyp2[[2]]), colSums(Dsole_MLE_NOdet_fi.std_hyp3[[2]]),colSums(Dsole_MLE_NOdet_fi.std_hyp4[[2]]) , colSums(Dsole_MLE_det_fi.2_1[[2]]), colSums(Dsole_MLE_det_fi.2_2[[2]]), colSums(Dsole_MLE_det_fi.2_3[[2]]), colSums(Dsole_MLE_det_fi.2_4[[2]]))
Pop_NOdet <- rbind( colSums(Dsole_MLE_NOdet_fi.std1[[2]]), colSums(Dsole_MLE_NOdet_fi.std2[[2]]), colSums(Dsole_MLE_NOdet_fi.std3[[2]]),colSums(Dsole_MLE_NOdet_fi.std4[[2]]) , colSums(Dsole_MLE_NOdet_fi.2_1[[2]]), colSums(Dsole_MLE_NOdet_fi.2_2[[2]]), colSums(Dsole_MLE_NOdet_fi.2_3[[2]]), colSums(Dsole_MLE_NOdet_fi.2_4[[2]]))


# extracting the timeseries that show absence for each replicate
Pop_abs_det <-NULL
Pop_abs_NOdet <-NULL
for(i in 1:8){
 Pop_abs_det[i] <- length(which(Pop_det[i,] <= 0))
 Pop_abs_NOdet[i] <- length(which(Pop_NOdet[i,] <= 0))
}

#df for results of fi = 0.008
hypox_param_check <- data.frame(Test = rep(c("W/out_Hypoxia", "Hypoxia_inc."), each = 4),
                                true_Fi = rep(exp(test_params$Fi[1]),4),
                                Fi_Estimate = c(Fi_ests_NOdet[1:4], Fi_ests_det[1:4]),
                                Replicate = rep(1:4, 2),
                                Absent = c(Pop_abs_NOdet[1:4], Pop_abs_det[1:4])) # add 0.2 when finished

#df for results of fi = 0.2
hypox_param_check2 <- data.frame(Test = rep(c("W/out_Hypoxia", "Hypoxia_inc."), each = 4),
                                true_Fi = rep(exp(test_params$Fi[2]),4),
                                Fi_Estimate = c(Fi_ests_NOdet[5:8], Fi_ests_det[5:8]),
                                Replicate = rep(1:4, 2),
                                Absent = c(Pop_abs_NOdet[5:8], Pop_abs_det[5:8])) # add 0.2 when finished


#hypox_param_check <- hypox_param_check %>% 
 # mutate(Percent_Diff = (Test_value - Fi_Estimate)*100)
#hypox_param_check$Percent_Diff <- as.character(round(hypox_param_check$Percent_Diff, 4))

# df for plot of true fi value
True_Fi <- data.frame(x= c(-Inf, Inf),
                      y= round(hypox_param_check$true_Fi[1],5),
                      True_Fi = factor(round(hypox_param_check$true_Fi[1],5)))

# plot of true fi
true <- ggplot(hypox_param_check, aes(x=Test, y=Fi_Estimate))+
  geom_point(position = "jitter", aes(color=Absent))+
  scale_color_viridis(discrete=F)+
  #scale_color_manual(values = c("#00AFBB", "#E7B800")) +
  ggtitle("Fishing Rate 0.00816")+
  geom_line(aes(x, y, linetype = True_Fi), True_Fi, color="red")
  #geom_line(aes(x, y, linetype = mortality), mortality, color = "purple")

  # df for plot of fi value 0.2
  Fi_0.2 <- data.frame(x= c(-Inf, Inf),
                        y= round(hypox_param_check2$true_Fi[1],5),
                      Fi_0.2 = factor(round(hypox_param_check2$true_Fi[1],5)))


## plot of fi at 0.2
fi.2 <- ggplot(hypox_param_check2, aes(x=Test, y=Fi_Estimate))+
  geom_point(position = "jitter", aes(color=Absent))+
  scale_color_viridis(discrete=F)+
  #scale_color_manual(values = c("#00AFBB", "#E7B800")) +
  ggtitle("Fishing Rate 0.2")+
  geom_line(aes(x, y, linetype = Fi_0.2), Fi_0.2, color="red")
  #geom_line(aes(x, y, linetype = mortality), mortality, color = "purple")

true + fi.2

```




## OPTION six
# test with true Fi and very large Fi with and without hypoxia &&& with different values of rec_var
```{r}
pars <- params("Dsole")
library(patchwork)
# load(Dsole_MLE_det or Dsole_MLE_NOdet) # all of them =(5 each)
test_params <- data.frame(Fi= c(log(pars$f), log(0.2))) #fi




### MLE results for runs with hypoxia 
# rec_var = 0.1
Fi_ests_det_rec0.1 <- c(exp(coef(summary(Dsole_MLE_det_std.1[[1]][[1]]))[3,1]),  exp(coef(summary(Dsole_MLE_det_std.2[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_std.3[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_std.4[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi0.2.1[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi0.2.2[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi0.2.3[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi0.2.4[[1]][[1]]))[3,1]))
# rec_var = 0.3
Fi_ests_det_rec0.3 <- c(exp(coef(summary(Dsole_MLE_det_std.1[[2]][[1]]))[3,1]),  exp(coef(summary(Dsole_MLE_det_std.2[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_std.3[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_std.4[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi0.2.1[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi0.2.2[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi0.2.3[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_MLE_det_fi0.2.4[[2]][[1]]))[3,1]))

### MLE results for runs without hypoxia
# rec_var = 0.1
Fi_ests_NOdet_rec0.1 <- c(exp(coef(summary(Dsole_MLE_NOdet_std.1[[1]][[1]]))[1,1]),  exp(coef(summary(Dsole_MLE_NOdet_std.2[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_std.3[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_std.4[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi0.2.1[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi0.2.2[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi0.2.3[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi0.2.4[[1]][[1]]))[1,1]))
# rec_var = 0.3
Fi_ests_NOdet_rec0.3 <- c(exp(coef(summary(Dsole_MLE_NOdet_std.1[[2]][[1]]))[1,1]),  exp(coef(summary(Dsole_MLE_NOdet_std.2[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_std.3[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_std.4[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi0.2.1[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi0.2.2[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi0.2.3[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_MLE_NOdet_fi0.2.4[[2]][[1]]))[1,1]))





## number of absences per sample 
# rec_var = 0.1
Pop_det0.1 <- rbind( colSums(Dsole_MLE_det_std.1[[1]][[2]]), colSums(Dsole_MLE_det_std.2[[1]][[2]]), colSums(Dsole_MLE_det_std.3[[1]][[2]]),colSums(Dsole_MLE_det_std.4[[1]][[2]]), Dsole_MLE_det_fi0.2.1[[1]][[2]], Dsole_MLE_det_fi0.2.2[[1]][[2]], Dsole_MLE_det_fi0.2.3[[1]][[2]], Dsole_MLE_det_fi0.2.4[[1]][[2]] )
# rec_var = 0.3
Pop_det0.3 <- rbind( colSums(Dsole_MLE_det_std.1[[2]][[2]]), colSums(Dsole_MLE_det_std.2[[2]][[2]]), colSums(Dsole_MLE_det_std.3[[2]][[2]]),colSums(Dsole_MLE_det_std.4[[2]][[2]]), Dsole_MLE_det_fi0.2.1[[2]][[2]], Dsole_MLE_det_fi0.2.2[[2]][[2]], Dsole_MLE_det_fi0.2.3[[2]][[2]], Dsole_MLE_det_fi0.2.4[[2]][[2]] )


# rec_var = 0.1
Pop_NOdet0.1 <- rbind( colSums(Dsole_MLE_NOdet_std.1[[1]][[2]]), colSums(Dsole_MLE_NOdet_std.2[[1]][[2]]), colSums(Dsole_MLE_NOdet_std.3[[1]][[2]]),colSums(Dsole_MLE_NOdet_std.4[[1]][[2]]), colSums(Dsole_MLE_NOdet_fi0.2.1[[1]][[2]]), colSums(Dsole_MLE_NOdet_fi0.2.2[[1]][[2]]), colSums(Dsole_MLE_NOdet_fi0.2.3[[1]][[2]]), colSums(Dsole_MLE_NOdet_fi0.2.4[[1]][[2]]))
# rec_var = 0.3
Pop_NOdet0.3 <- rbind( colSums(Dsole_MLE_NOdet_std.1[[2]][[2]]), colSums(Dsole_MLE_NOdet_std.2[[2]][[2]]), colSums(Dsole_MLE_NOdet_std.3[[2]][[2]]),colSums(Dsole_MLE_NOdet_std.4[[2]][[2]]), colSums(Dsole_MLE_NOdet_fi0.2.1[[2]][[2]]), colSums(Dsole_MLE_NOdet_fi0.2.2[[2]][[2]]), colSums(Dsole_MLE_NOdet_fi0.2.3[[2]][[2]]), colSums(Dsole_MLE_NOdet_fi0.2.4[[2]][[2]]))



# extracting the timeseries that show absence for each replicate
Pop_abs_det0.1 <-NULL
Pop_abs_det0.3 <-NULL
Pop_abs_NOdet0.1 <-NULL
Pop_abs_NOdet0.3 <-NULL
for(i in 1:8){
 Pop_abs_det0.1[i] <- length(which(Pop_det0.1[i,] <= 0))
 Pop_abs_det0.3[i] <- length(which(Pop_det0.3[i,] <= 0))
 Pop_abs_NOdet0.1[i] <- length(which(Pop_NOdet0.1[i,] <= 0))
 Pop_abs_NOdet0.3[i] <- length(which(Pop_NOdet0.3[i,] <= 0))
}

#df for results of fi = 0.008
hypox_param_check_std_0.1 <- data.frame(Test = rep(c("W/out_Hypoxia", "Hypoxia_inc."), each = 4),
                                true_Fi = rep(exp(test_params$Fi[1]),4),
                                Fi_Estimate = c(Fi_ests_NOdet_rec0.1[1:4], Fi_ests_det_rec0.1[1:4]),
                                Replicate = rep(1:4, 2),
                                Absent = c(Pop_abs_NOdet0.1[1:4], Pop_abs_det0.1[1:4])) # add 0.2 when finished

#df for results of fi = 0.2
hypox_param_checkfi_0.2_0.1 <- data.frame(Test = rep(c("W/out_Hypoxia", "Hypoxia_inc."), each = 4),
                                true_Fi = rep(exp(test_params$Fi[2]),4),
                                Fi_Estimate = c(Fi_ests_NOdet_rec0.1[5:8], Fi_ests_det_rec0.1[5:8]),
                                Replicate = rep(1:4, 2),
                                Absent = c(Pop_abs_NOdet0.1[5:8], Pop_abs_det0.1[5:8])) # add 0.2 when finished


#hypox_param_check <- hypox_param_check %>% 
 # mutate(Percent_Diff = (Test_value - Fi_Estimate)*100)
#hypox_param_check$Percent_Diff <- as.character(round(hypox_param_check$Percent_Diff, 4))

# df for plot of true fi value
True_Fi <- data.frame(x= c(-Inf, Inf),
                      y= round(hypox_param_check_std_0.1$true_Fi[1],5),
                      True_Fi = factor(round(hypox_param_check_std_0.1$true_Fi[1],5)))

# plot of true fi
true_0.1 <- ggplot(hypox_param_check_std_0.1, aes(x=Test, y=Fi_Estimate))+
  geom_point(position = "jitter", aes(color=Absent))+
  scale_color_viridis(discrete=F)+
  #scale_color_manual(values = c("#00AFBB", "#E7B800")) +
  ggtitle("Fishing Rate 0.00816 & Recruit. 0.1")+
  geom_line(aes(x, y, linetype = True_Fi), True_Fi, color="red")
  #geom_line(aes(x, y, linetype = mortality), mortality, color = "purple")

  # df for plot of fi value 0.2
  Fi_0.2 <- data.frame(x= c(-Inf, Inf),
                        y= round(hypox_param_checkfi_0.2_0.1$true_Fi[1],5),
                      Fi_0.2 = factor(round(hypox_param_checkfi_0.2_0.1$true_Fi[1],5)))


## plot of fi at 0.2
fi.2_0.1 <- ggplot(hypox_param_checkfi_0.2_0.1, aes(x=Test, y=Fi_Estimate))+
  geom_point(position = "jitter", aes(color=Absent))+
  scale_color_viridis(discrete=F)+
  #scale_color_manual(values = c("#00AFBB", "#E7B800")) +
  ggtitle("Fishing Rate 0.2 & Recruit. 0.1")+
  geom_line(aes(x, y, linetype = Fi_0.2), Fi_0.2, color="red")
  #geom_line(aes(x, y, linetype = mortality), mortality, color = "purple")

true_0.1 + fi.2_0.1
```

##Option 7 same as above but one value of rec var
```{r}
pars <- params("Dsole")
library(patchwork)
library(ggplot2)
library(viridis)
# load(Dsole_MLE_det or Dsole_MLE_NOdet) # all of them =(5 each)
test_params <- data.frame(Fi= c(log(pars$f), log(0.2))) #fi

# MLE results for runs with hypoxia 
Fi_ests_det <- c(exp(coef(summary(Dsole_det_1[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_det_2[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_det_3[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_det_4[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_det_5[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_det_6[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_det_7[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_det_8[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_det_9[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_det_10[[1]][[1]]))[3,1]), exp(coef(summary(Dsole_det_1[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_det_2[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_det_3[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_det_4[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_det_5[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_det_6[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_det_7[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_det_8[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_det_9[[2]][[1]]))[3,1]), exp(coef(summary(Dsole_det_10[[2]][[1]]))[3,1]))
# MLE results for runs without hypoxia
Fi_ests_NOdet <- c(exp(coef(summary(Dsole_NOdet_1[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_2[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_3[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_4[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_5[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_6[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_7[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_7[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_9[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_10[[1]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_1[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_2[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_3[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_4[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_5[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_6[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_7[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_8[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_9[[2]][[1]]))[1,1]), exp(coef(summary(Dsole_NOdet_10[[2]][[1]]))[1,1]) )
real_fi = pars$f


## number of absences per sample 
Pop_det <- rbind(colSums(Dsole_det_1[[1]][[2]]), colSums(Dsole_det_2[[1]][[2]]), colSums(Dsole_det_3[[1]][[2]]),colSums(Dsole_det_4[[1]][[2]]), colSums(Dsole_det_5[[1]][[2]]), colSums(Dsole_det_6[[1]][[2]]), colSums(Dsole_det_7[[1]][[2]]), colSums(Dsole_det_8[[1]][[2]]), colSums(Dsole_det_9[[1]][[2]]), colSums(Dsole_det_10[[1]][[2]]), colSums(Dsole_det_1[[2]][[2]]), colSums(Dsole_det_2[[2]][[2]]), colSums(Dsole_det_3[[2]][[2]]), colSums(Dsole_det_4[[2]][[2]]), colSums(Dsole_det_5[[2]][[2]]), colSums(Dsole_det_6[[2]][[2]]), colSums(Dsole_det_7[[2]][[2]]), colSums(Dsole_det_8[[2]][[2]]), colSums(Dsole_det_9[[2]][[2]]), colSums(Dsole_det_10[[2]][[2]]))

Pop_NOdet <- rbind(colSums(Dsole_NOdet_1[[1]][[2]]), colSums(Dsole_NOdet_2[[1]][[2]]), colSums(Dsole_NOdet_3[[1]][[2]]),colSums(Dsole_NOdet_4[[1]][[2]]),colSums(Dsole_NOdet_5[[1]][[2]]),colSums(Dsole_NOdet_6[[1]][[2]]), colSums(Dsole_NOdet_7[[1]][[2]]), colSums(Dsole_NOdet_8[[1]][[2]]), colSums(Dsole_NOdet_9[[1]][[2]]),colSums(Dsole_NOdet_10[[1]][[2]]), colSums(Dsole_NOdet_1[[2]][[2]]), colSums(Dsole_NOdet_2[[2]][[2]]), colSums(Dsole_NOdet_3[[2]][[2]]), colSums(Dsole_NOdet_4[[2]][[2]]), colSums(Dsole_NOdet_5[[2]][[2]]), colSums(Dsole_NOdet_6[[2]][[2]]), colSums(Dsole_NOdet_7[[2]][[2]]), colSums(Dsole_NOdet_8[[2]][[2]]), colSums(Dsole_NOdet_9[[2]][[2]]), colSums(Dsole_NOdet_10[[2]][[2]]))

# extracting the timeseries that show absence for each replicate
Pop_abs_det <-NULL
Pop_abs_NOdet <-NULL
for(i in 1:20){
 Pop_abs_det[i] <- length(which(Pop_det[i,] <= 0))
 Pop_abs_NOdet[i] <- length(which(Pop_NOdet[i,] <= 0))
}

#df for results of fi = 0.008
hypox_param_check <- data.frame(Test = rep(c("W/out_Hypoxia", "Hypoxia_inc."), each = 10),
                                true_Fi = rep(exp(test_params$Fi[1]),10),
                                Fi_Estimate = c(Fi_ests_NOdet[1:10], Fi_ests_det[1:10]),
                                Replicate = rep(1:10, 2),
                                Absent = c(Pop_abs_NOdet[1:10], Pop_abs_det[1:10])) # add 0.2 when finished

#df for results of fi = 0.2
hypox_param_check2 <- data.frame(Test = rep(c("W/out_Hypoxia", "Hypoxia_inc."), each = 10),
                                true_Fi = rep(exp(test_params$Fi[2]), 10),
                                Fi_Estimate = c(Fi_ests_NOdet[11:20], Fi_ests_det[11:20]),
                                Replicate = rep(1:10, 2),
                                Absent = c(Pop_abs_NOdet[11:20], Pop_abs_det[11:20])) # add 0.2 when finished


#hypox_param_check <- hypox_param_check %>% 
 # mutate(Percent_Diff = (Test_value - Fi_Estimate)*100)
#hypox_param_check$Percent_Diff <- as.character(round(hypox_param_check$Percent_Diff, 4))

# df for plot of true fi value
True_Fi <- data.frame(x= c(-Inf, Inf),
                      y= round(hypox_param_check$true_Fi[1],5),
                      True_Fi = factor(round(hypox_param_check$true_Fi[1],5)))

# plot of true fi
true <- ggplot(hypox_param_check, aes(x=Test, y=Fi_Estimate))+
  geom_point( aes(color=Absent))+
  scale_color_viridis(discrete=F)+
  #scale_color_manual(values = c("#00AFBB", "#E7B800")) +
  ggtitle("Fishing Rate 0.00816")+
  geom_line(aes(x, y, linetype = True_Fi), True_Fi, color="red")
  #geom_line(aes(x, y, linetype = mortality), mortality, color = "purple")

  # df for plot of fi value 0.2
  Fi_0.2 <- data.frame(x= c(-Inf, Inf),
                        y= round(hypox_param_check2$true_Fi[1],5),
                      Fi_0.2 = factor(round(hypox_param_check2$true_Fi[1],5)))


## plot of fi at 0.2
fi.2 <- ggplot(hypox_param_check2, aes(x=Test, y=Fi_Estimate))+
  geom_point( aes(color=Absent))+
  scale_color_viridis(discrete=F)+
  #scale_color_manual(values = c("#00AFBB", "#E7B800")) +
  ggtitle("Fishing Rate 0.2")+
  geom_line(aes(x, y, linetype = Fi_0.2), Fi_0.2, color="red")
  #geom_line(aes(x, y, linetype = mortality), mortality, color = "purple")








#### if you want to ignore absences 
#ggplot(hypox_param_check2, aes(x=Test, y=Fi_Estimate))+
#  geom_point(position = "jitter", aes(color=Test))+
#  scale_color_manual(values = c("#00AFBB", "#E7B800")) +
#  ggtitle("Fishing Rate 0.2")+
#  geom_line(aes(x, y, linetype = Fi_0.2), Fi_0.2, color="red")+
#  gudies(color=F)

true + fi.2


```




#for MTAG
##Option 7 same as above but one value of rec var and not tidyr
```{r}
pars <- params("Dsole")
library(patchwork)
library(ggplot2)
library(viridis)
# load(Dsole_MLE_det or Dsole_MLE_NOdet) # all of them =(5 each)
test_params <- data.frame(Fi= c(log(pars$f), log(0.2))) #fi

# MLE results for runs with hypoxia 
Fi_ests_det <- c(exp(coef(summary(Rep_Dsole_det_1[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_3[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_4[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_5[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_6[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_7[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_9[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_10[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_11[[1]][[1]]))[3,1]),exp(coef(summary(Rep_Dsole_det_12[[1]][[1]]))[3,1]),
exp(coef(summary(Rep_Dsole_det_13[[1]][[1]]))[3,1]),exp(coef(summary(Rep_Dsole_det_14[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_15[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_16[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_17[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_18[[1]][[1]]))[3,1]),
exp(coef(summary(Rep_Dsole_det_1[[2]][[1]]))[3,1]), 
 exp(coef(summary(Rep_Dsole_det_3[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_4[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_5[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_6[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_7[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_9[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_10[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_11[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_12[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_13[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_14[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_15[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_16[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_17[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_18[[2]][[1]]))[3,1]))


#exp(coef(summary(Rep_Dsole_det_7[[1]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_8[[1]][[1]]))[3,1]),,
#exp(coef(summary(Rep_Dsole_det_7[[2]][[1]]))[3,1]), exp(coef(summary(Rep_Dsole_det_8[[2]][[1]]))[3,1])


# MLE results for runs without hypoxia
Fi_ests_NOdet <- c(exp(coef(summary(Rep_Dsole_NOdet_1[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_3[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_4[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_5[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_6[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_8[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_9[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_10[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_11[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_12[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_13[[1]][[1]]))[1,1]),
exp(coef(summary(Rep_Dsole_NOdet_14[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_15[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_16[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_17[[1]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_18[[1]][[1]]))[1,1]),exp(coef(summary(Rep_Dsole_NOdet_1[[2]][[1]]))[1,1]),  exp(coef(summary(Rep_Dsole_NOdet_3[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_4[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_5[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_6[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_8[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_9[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_10[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_11[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_12[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_13[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_14[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_15[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_16[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_17[[2]][[1]]))[1,1]), exp(coef(summary(Rep_Dsole_NOdet_18[[2]][[1]]))[1,1]))
real_fi = pars$f


## number of absences per sample 
Pop_det <- rbind(colSums(Rep_Dsole_det_1[[1]][[2]]$N.act), colSums(Rep_Dsole_det_3[[1]][[2]]$N.act), colSums(Rep_Dsole_det_4[[1]][[2]]$N.act), colSums(Rep_Dsole_det_5[[1]][[2]]$N.act), colSums(Rep_Dsole_det_6[[1]][[2]]$N.act), colSums(Rep_Dsole_det_7[[1]][[2]]$N.act), colSums(Rep_Dsole_det_9[[1]][[2]]$N.act), colSums(Rep_Dsole_det_10[[1]][[2]]$N.act), colSums(Rep_Dsole_det_11[[1]][[2]]$N.act), colSums(Rep_Dsole_det_12[[1]][[2]]$N.act), colSums(Rep_Dsole_det_13[[1]][[2]]$N.act),colSums(Rep_Dsole_det_14[[1]][[2]]$N.act), colSums(Rep_Dsole_det_15[[1]][[2]]$N.act), colSums(Rep_Dsole_det_16[[1]][[2]]$N.act), colSums(Rep_Dsole_det_17[[1]][[2]]$N.act), colSums(Rep_Dsole_det_18[[1]][[2]]$N.act), colSums(Rep_Dsole_det_1[[2]][[2]]$N.act),colSums(Rep_Dsole_det_3[[2]][[2]]$N.act), colSums(Rep_Dsole_det_4[[2]][[2]]$N.act), colSums(Rep_Dsole_det_5[[2]][[2]]$N.act), colSums(Rep_Dsole_det_6[[2]][[2]]$N.act), colSums(Rep_Dsole_det_7[[2]][[2]]$N.act), colSums(Rep_Dsole_det_9[[2]][[2]]$N.act), colSums(Rep_Dsole_det_10[[2]][[2]]$N.act), colSums(Rep_Dsole_det_11[[2]][[2]]$N.act), colSums(Rep_Dsole_det_12[[2]][[2]]$N.act), colSums(Rep_Dsole_det_13[[2]][[2]]$N.act), colSums(Rep_Dsole_det_14[[2]][[2]]$N.act), colSums(Rep_Dsole_det_15[[2]][[2]]$N.act), colSums(Rep_Dsole_det_16[[2]][[2]]$N.act), colSums(Rep_Dsole_det_17[[2]][[2]]$N.act), colSums(Rep_Dsole_det_18[[2]][[2]]$N.act))
#colSums(Rep_Dsole_det_7[[1]][[2]]$N.act), colSums(Rep_Dsole_det_8[[1]][[2]]$N.act), , , colSums(Rep_Dsole_det_7[[2]][[2]]$N.act), colSums(Rep_Dsole_det_8[[2]][[2]]$N.act)


Pop_NOdet <- rbind(colSums(Rep_Dsole_NOdet_1[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_3[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_4[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_5[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_6[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_8[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_9[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_10[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_11[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_12[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_13[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_14[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_15[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_16[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_17[[1]][[2]]$N.act), colSums(Rep_Dsole_NOdet_18[[1]][[2]]$N.act),
colSums(Rep_Dsole_NOdet_1[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_3[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_4[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_5[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_6[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_8[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_9[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_10[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_11[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_12[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_13[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_14[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_15[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_16[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_17[[2]][[2]]$N.act), colSums(Rep_Dsole_NOdet_18[[2]][[2]]$N.act))

# extracting the timeseries that show absence for each replicate
Pop_abs_det <-NULL
Pop_abs_NOdet <-NULL
for(i in 1:32){
 Pop_abs_det[i] <- length(which(Pop_det[i,] <= 0))
 Pop_abs_NOdet[i] <- length(which(Pop_NOdet[i,] <= 0))
}

#df for results of fi = 0.008
hypox_param_check <- data.frame(Test = rep(c("W/out_Hypoxia", "Hypoxia_inc."), each = 16),
                                true_Fi = rep(exp(test_params$Fi[1]),16),
                                Fi_Estimate = c(Fi_ests_NOdet[1:16], Fi_ests_det[1:16]),
                                Replicate = rep(1:16, 2),
                                Absent = c(Pop_abs_NOdet[1:16], Pop_abs_det[1:16])) # add 0.2 when finished

#df for results of fi = 0.2
hypox_param_check2 <- data.frame(Test = rep(c("W/out_Hypoxia", "Hypoxia_inc."), each = 16),
                                true_Fi = rep(exp(test_params$Fi[2]), 16),
                                Fi_Estimate = c(Fi_ests_NOdet[17:32], Fi_ests_det[17:32]),
                                Replicate = rep(1:16, 2),
                                Absent = c(Pop_abs_NOdet[17:32], Pop_abs_det[17:32])) # add 0.2 when finished


#hypox_param_check <- hypox_param_check %>% 
 # mutate(Percent_Diff = (Test_value - Fi_Estimate)*100)
#hypox_param_check$Percent_Diff <- as.character(round(hypox_param_check$Percent_Diff, 4))

# df for plot of true fi value
True_Fi <- data.frame(x= c(-Inf, Inf),
                      y= round(hypox_param_check$true_Fi[1],5),
                      True_Fi = factor(round(hypox_param_check$true_Fi[1],5)))

# plot of true fi
true <- ggplot(hypox_param_check, aes(x=Test, y=Fi_Estimate))+
  geom_point( aes(color=Absent))+
  scale_color_viridis(discrete=F)+
  #scale_color_manual(values = c("#00AFBB", "#E7B800")) +
  ggtitle("Fishing Rate 0.00816")+
  geom_line(aes(x, y, linetype = True_Fi), True_Fi, color="red")
  #geom_line(aes(x, y, linetype = mortality), mortality, color = "purple")

  # df for plot of fi value 0.2
  Fi_0.2 <- data.frame(x= c(-Inf, Inf),
                        y= round(hypox_param_check2$true_Fi[1],5),
                      Fi_0.2 = factor(round(hypox_param_check2$true_Fi[1],5)))


## plot of fi at 0.2
fi.2 <- ggplot(hypox_param_check2, aes(x=Test, y=Fi_Estimate))+
  geom_point( aes(color=Absent))+
  scale_color_viridis(discrete=F)+
  #scale_color_manual(values = c("#00AFBB", "#E7B800")) +
  ggtitle("Fishing Rate 0.2")+
  geom_line(aes(x, y, linetype = Fi_0.2), Fi_0.2, color="red")
  #geom_line(aes(x, y, linetype = mortality), mortality, color = "purple")


#### if you want to ignore absences 
#ggplot(hypox_param_check2, aes(x=Test, y=Fi_Estimate))+
#  geom_point(position = "jitter", aes(color=Test))+
#  scale_color_manual(values = c("#00AFBB", "#E7B800")) +
#  ggtitle("Fishing Rate 0.2")+
#  geom_line(aes(x, y, linetype = Fi_0.2), Fi_0.2, color="red")+
#  gudies(color=F)

true + fi.2


```







## plots fpr above but recr_0.3
```{r}
### results for recruitment at 0.3
#df for results of fi = 0.008
hypox_param_check_std_0.3 <- data.frame(Test = rep(c("W/out_Hypoxia", "Hypoxia_inc."), each = 4),
                                true_Fi = rep(exp(test_params$Fi[1]),4),
                                Fi_Estimate = c(Fi_ests_NOdet_rec0.3[1:4], Fi_ests_det_rec0.3[1:4]),
                                Replicate = rep(1:4, 2),
                                Absent = c(Pop_abs_NOdet0.3[1:4], Pop_abs_det0.3[1:4])) # add 0.2 when finished

#df for results of fi = 0.2
hypox_param_checkfi_0.2_0.3 <- data.frame(Test = rep(c("W/out_Hypoxia", "Hypoxia_inc."), each = 4),
                                true_Fi = rep(exp(test_params$Fi[2]),4),
                                Fi_Estimate = c(Fi_ests_NOdet_rec0.3[5:8], Fi_ests_det_rec0.3[5:8]),
                                Replicate = rep(1:4, 2),
                                Absent = c(Pop_abs_NOdet0.3[5:8], Pop_abs_det0.3[5:8])) # add 0.2 when finished


#hypox_param_check <- hypox_param_check %>% 
 # mutate(Percent_Diff = (Test_value - Fi_Estimate)*100)
#hypox_param_check$Percent_Diff <- as.character(round(hypox_param_check$Percent_Diff, 4))

# df for plot of true fi value
True_Fi <- data.frame(x= c(-Inf, Inf),
                      y= round(hypox_param_check_std_0.3$true_Fi[1],5),
                      True_Fi = factor(round(hypox_param_check_std_0.3$true_Fi[1],5)))

# plot of true fi
true_0.3 <- ggplot(hypox_param_check_std_0.3, aes(x=Test, y=Fi_Estimate))+
  geom_point(position = "jitter", aes(color=Absent))+
  scale_color_viridis(discrete=F)+
  #scale_color_manual(values = c("#00AFBB", "#E7B800")) +
  ggtitle("Fishing Rate 0.00816 & Recruit. 0.3")+
  geom_line(aes(x, y, linetype = True_Fi), True_Fi, color="red")
  #geom_line(aes(x, y, linetype = mortality), mortality, color = "purple")

  # df for plot of fi value 0.2
  Fi_0.2 <- data.frame(x= c(-Inf, Inf),
                        y= round(hypox_param_checkfi_0.2_0.3$true_Fi[1],5),
                      Fi_0.2 = factor(round(hypox_param_checkfi_0.2_0.3$true_Fi[1],5)))


## plot of fi at 0.2
fi.2_0.3 <- ggplot(hypox_param_checkfi_0.2_0.3, aes(x=Test, y=Fi_Estimate))+
  geom_point(position = "jitter", aes(color=Absent))+
  scale_color_viridis(discrete=F)+
  #scale_color_manual(values = c("#00AFBB", "#E7B800")) +
  ggtitle("Fishing Rate 0.2 & Recruit. 0.3")+
  geom_line(aes(x, y, linetype = Fi_0.2), Fi_0.2, color="red")
  #geom_line(aes(x, y, linetype = mortality), mortality, color = "purple")

true_0.3 + fi.2_0.3

```


#plot for point estimates (option 1-3)
```{r}
# df of the true param values 

#point plot to show how it ranges with the true value
ggplot(summ[summ$Bias <100,], aes(Param, Estimate, color=Test))+
  geom_point(position = "jitter")+
  viridis::scale_color_viridis(discrete=T)+
  geom_point(data=true, color="red", shape= 2, size = 1)+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1)) 
## 4, 1.009 is true values

```

# heat map (option 1-3)
```{r}
# heat map that shows bias of the estimate from true values
ggplot(summ[summ$Bias >= -25 & summ$Bias <= 25, ], aes(Param, Test)) +
  geom_tile(aes(fill = Bias), colour = "white") +
  scale_fill_viridis(name="Temperature")+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))

```


# results for real data
```{r}
load("Dsole_MLE_nann.Rdata")
Dsole_results <- data.frame(Parameters = names(coef(Dsole_MLE_nann)[c(1:3,5:12)]),
                            Estimates = rep(NA, 11),
                            Std_Error = rep(NA, 11))

Dsole_results <- as.data.frame(coef(summary(Dsole_MLE_nann))[,1:2])
Dsole_results$Upper <- exp(Dsole_results$Estimate  + 1.96*Dsole_results$"Std. Error")
Dsole_results$Lower <- exp(Dsole_results$Estimate  - 1.96*Dsole_results$"Std. Error")
Dsole_results[3:4,1] <- exp(Dsole_results[3:4,1])

ests<-coef(summary(Dsole_MLE_nann))[,1]
ests[3:4] <- exp(ests[3:4])
Dsole_est <- data.frame(Parameters = rep( names(coef(Dsole_MLE_nann)[c(1:3,5:12)]), 2),
                        Scenario = rep(c("Estimates", "Start"), each = 11),
                        Estimates = c(ests, c(3, -7, 0.00816, 0.5, 1e6, 0,0,0,0,0,0)))


ggplot(Dsole_est[Dsole_est$Parameters !="scale",], aes(Parameters, Estimates, color=Scenario))+
  geom_point()
```



